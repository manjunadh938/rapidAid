<!DOCTYPE html>
<html>
<head>
  <title>RapidAid Emergency</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="header">
  <div class="logo">üöë RapidAid Emergency</div>
</div>

<main class="main-container">

  <input type="tel" id="contactNumber" placeholder="Emergency WhatsApp number" />

  <button class="sos-button" id="sosBtn">SOS</button>

  <h3>Immediate First Aid</h3>

  <div class="card-row">
    <div class="card" onclick="showHelp('cpr')">‚ù§Ô∏è CPR</div>
    <div class="card" onclick="showHelp('bleeding')">ü©∏ Bleeding</div>
    <div class="card" onclick="showHelp('unconscious')">üòµ Unconscious</div>
  </div>

  <div class="help-box" id="helpBox"></div>

</main>

<a id="callBtn" class="call-fab" href="#">üìû</a>

<audio id="siren" src="https://actions.google.com/sounds/v1/alarms/siren_whistle.ogg"></audio>

<script>
// Load saved contact automatically
window.addEventListener("load", () => {
  const saved = localStorage.getItem("emergencyContact");
  if (saved) document.getElementById("contactNumber").value = saved;
});

// SOS button click
document.getElementById("sosBtn").addEventListener("click", () => {
  const contact = document.getElementById("contactNumber").value;
  if (!contact) return alert("Enter emergency contact number");

  localStorage.setItem("emergencyContact", contact);

  navigator.geolocation.getCurrentPosition(position => {
    fetch("/sos", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        lat: position.coords.latitude,
        lng: position.coords.longitude,
        contact: contact,
        type: "General Emergency"
      })
    })
    .then(res => res.json())
    .then(data => {
      document.querySelector(".sos-button").classList.add("active");
      document.getElementById("siren").play();

      const mapLink = `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}`;
      const message = `üö® EMERGENCY ALERT üö®\nLive Location: ${mapLink}\nHospital: ${data.hospital}`;
      const whatsappURL = `https://wa.me/${contact.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(message)}`;

      window.open(whatsappURL, "_blank");
      document.getElementById("callBtn").href = `tel:${contact}`;
    });
  });
});

// First aid help
function showHelp(type) {
  const help = {
    cpr: `
<b>ü´Ä CPR (Cardiopulmonary Resuscitation)</b><br><br>
1Ô∏è‚É£ Check if the person is responsive. Shake gently and shout.<br>
2Ô∏è‚É£ Call emergency services immediately.<br>
3Ô∏è‚É£ Place the person on their back on a firm surface.<br>
4Ô∏è‚É£ Put one hand on the center of the chest, other on top.<br>
5Ô∏è‚É£ Push hard and fast (100‚Äì120 compressions per minute).<br>
6Ô∏è‚É£ Let chest fully rise between compressions.<br>
7Ô∏è‚É£ If trained, give 2 rescue breaths after every 30 compressions.<br>
‚ö†Ô∏è Continue until medical help arrives or person starts breathing.
`,
    bleeding: `
<b>ü©∏ Severe Bleeding Control</b><br><br>
1Ô∏è‚É£ Stay calm and make the person lie down.<br>
2Ô∏è‚É£ Apply firm, direct pressure using cloth or bandage.<br>
3Ô∏è‚É£ Do NOT remove objects stuck in wounds ‚Äî press around them.<br>
4Ô∏è‚É£ Raise the injured area above heart level if possible.<br>
5Ô∏è‚É£ If blood soaks through, place another cloth on top ‚Äî don‚Äôt remove first one.<br>
6Ô∏è‚É£ Watch for signs of shock (pale skin, fast breathing).<br>
‚ö†Ô∏è Keep pressure until emergency help arrives.
`,
    unconscious: `
<b>üòµ Unconscious Person Care</b><br><br>
1Ô∏è‚É£ Check breathing and pulse immediately.<br>
2Ô∏è‚É£ If not breathing ‚Üí start CPR.<br>
3Ô∏è‚É£ If breathing ‚Üí place in recovery position (on their side).<br>
4Ô∏è‚É£ Loosen tight clothing.<br>
5Ô∏è‚É£ Do NOT give food or water.<br>
6Ô∏è‚É£ Keep the person warm and monitor breathing.<br>
‚ö†Ô∏è Call emergency services right away.
`
  };

  document.getElementById("helpBox").innerHTML = help[type];
}
</script>

</body>
</html>
